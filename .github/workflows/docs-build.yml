name: docs-build
on:
  push: { branches: [ main ] }
  pull_request: { branches: [ main ] }
permissions: { contents: read }
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with: { python-version: '3.11' }
      - name: Install deps
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
      - name: Preflight
        run: make verify
      - name: Build manuals
        run: |
          set -e
          make build_dark
          make build_light
      - name: Checksums
        run: |
          mkdir -p output/checksums
          find output -maxdepth 1 -name '*.pdf' -print0 \
            | xargs -0 -I{} sh -c 'sha256sum "{}" > "output/checksums/$(basename "{}").sha256"'
      - name: Upload artifacts
        uses: actions/upload-artifact@v4
        with:
          name: docs-build-${{ github.sha }}
          path: |
            output/*.pdf
            output/checksums/*.sha256
          if-no-files-found: warn
          retention-days: 14
