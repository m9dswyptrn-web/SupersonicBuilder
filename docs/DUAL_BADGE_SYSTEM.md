# Dual Badge System

Professional status badges with separate workflow status and completeness indicators.

## Overview

The dual badge system provides two distinct badges:
1. **Docs Release** - Shows workflow execution status (pass/fail)
2. **Docs Complete** - Shows asset completeness (complete/incomplete)

This separation gives users instant visibility into both build health and release quality.

---

## Quick Start

### Add Both Badges to README

```markdown
## Status

[![Docs Release](https://img.shields.io/endpoint?url=https://raw.githubusercontent.com/OWNER/REPO/main/.status/docs-release.json)](https://github.com/OWNER/REPO/releases/latest)
[![Docs Complete](https://img.shields.io/endpoint?url=https://raw.githubusercontent.com/OWNER/REPO/main/.status/docs-release-completeness.json)](https://github.com/OWNER/REPO/releases/latest)
```

**Replace:** `OWNER/REPO` with your GitHub repository path

---

## Badge States

### Docs Release Badge

| State | Color | Message | Meaning |
|-------|-------|---------|---------|
| **Passed** | ðŸŸ¢ Green | `v2.0.10 â€” passed` | Workflow succeeded + all required assets |
| **Incomplete** | ðŸŸ¡ Yellow | `v2.0.10 â€” incomplete` | Workflow succeeded but missing assets |
| **Failed** | ðŸ”´ Red | `v2.0.10 â€” failed` | Workflow failed |
| **Running** | ðŸŸ¡ Yellow | `v2.0.10 â€” running` | In progress |
| **No Release** | âšª Gray | `no releases yet` | None published |

### Docs Complete Badge

| State | Color | Message | Meaning |
|-------|-------|---------|---------|
| **Complete** | ðŸŸ¢ Green | `complete` | All required assets present |
| **Incomplete** | ðŸŸ¡ Yellow | `incomplete (2)` | Missing 2 required assets |
| **No Release** | âšª Gray | `no release` | No releases yet |

---

## Local Development Flow

### 1. Build Locally

```bash
make docs_release_local_strict
```

### 2. Check Completeness

```bash
make badge_compute_complete_local
```

**Output:**
```
Wrote .status/docs-release-completeness.local.json
Missing patterns (no matching asset names in release_assets/):
 - .*appendix.*_g[0-9a-f]{7,12}\.pdf$
```

### 3. Switch to Local Badge

```bash
make badges_local_on
```

This updates README to show the **local completeness badge** for preview.

### 4. Preview

Your README now shows the local badge state before you publish.

### 5. Ready for Release

```bash
make badges_live_on  # Switch back to live endpoints
```

---

## Workflow Integration

### badges_live_on

Switches README badges to **live** endpoints (production):
- `.status/docs-release-completeness.json` (updated by CI)

```bash
make badges_live_on
```

### badges_local_on

Switches README badges to **local** endpoints (development):
- `.status/docs-release-completeness.local.json` (computed locally)

```bash
make badges_local_on
```

---

## Make Targets

### Preview Badges

```bash
# Preview workflow-generated release badge
make badge_preview

# Preview workflow-generated completeness badge
make badge_preview_complete
```

### Compute Local Completeness

```bash
# Generate local completeness JSON from release_assets/
make badge_compute_complete_local
```

**What it does:**
1. Scans `release_assets/` for files
2. Checks against `.github/required-assets.txt` patterns
3. Writes `.status/docs-release-completeness.local.json`
4. Reports missing patterns

### Toggle Badge Endpoints

```bash
# Switch to live endpoints (for releases)
make badges_live_on

# Switch to local endpoints (for development)
make badges_local_on
```

---

## Complete Development Cycle

```bash
# 1. Build strict
make docs_release_local_strict

# 2. Check completeness
make badge_compute_complete_local

# Output:
# Wrote .status/docs-release-completeness.local.json
# Preview:
# {"schemaVersion":1,"label":"Docs Complete (local)","message":"complete","color":"brightgreen","labelColor":"black"}

# 3. Switch to local badge for preview
make badges_local_on

# 4. Commit and push to see local badge on GitHub
git add .status/docs-release-completeness.local.json README.md
git commit -m "docs: preview local completeness badge"
git push

# 5. When ready for real release:
make badges_live_on
git add README.md
git commit -m "docs: switch badges to live endpoints"
git push
git tag v2.0.14
git push --tags

# 6. CI automatically updates both badges
```

---

## Badge JSON Files

### Live Badges (CI-generated)

**Location:** `.status/docs-release.json`, `.status/docs-release-completeness.json`

**Updated by:** `docs-release-status-badge.yml` workflow

**Used for:** Production badges on README

### Local Badge (Developer-generated)

**Location:** `.status/docs-release-completeness.local.json`

**Generated by:** `make badge_compute_complete_local`

**Used for:** Preview before release

---

## Why Dual Badges?

### Before (Single Badge)

âŒ **Problem:** One badge tried to show both workflow status AND completeness
- Yellow could mean "incomplete assets" OR "workflow running"
- Red could mean "workflow failed" OR "missing critical assets"
- Ambiguous state communication

### After (Dual Badges)

âœ… **Solution:** Two badges with clear responsibilities

**Docs Release Badge:**
- Shows workflow execution health
- Green = workflow passed (may still have incomplete assets)
- Red = workflow failed (build/test issues)

**Docs Complete Badge:**
- Shows asset completeness independently
- Green = all required assets present
- Yellow = missing required assets (with count)

**Result:** Clear, unambiguous status at a glance

---

## Examples

### Scenario 1: Perfect Release

```markdown
[![Docs Release](passed - green badge)]
[![Docs Complete](complete - green badge)]
```

**Meaning:** Workflow passed âœ… + All assets present âœ…

---

### Scenario 2: Incomplete Assets

```markdown
[![Docs Release](passed - green badge)]
[![Docs Complete](incomplete (2) - yellow badge)]
```

**Meaning:** Workflow passed âœ… + Missing 2 required assets âš ï¸

**Action:** Check which assets are missing, rebuild, and re-release

---

### Scenario 3: Build Failed

```markdown
[![Docs Release](failed - red badge)]
[![Docs Complete](incomplete - yellow badge)]
```

**Meaning:** Workflow failed âŒ + Assets incomplete âš ï¸

**Action:** Fix build errors, then retry

---

### Scenario 4: First Release (No Releases Yet)

```markdown
[![Docs Release](no releases yet - gray badge)]
[![Docs Complete](no release - gray badge)]
```

**Meaning:** No releases published yet

**Action:** Tag and push first release

---

## Advanced: Repository Variable

Instead of `.github/required-assets.txt`, you can use a repository variable:

### Set Variable

1. GitHub **Settings** â†’ **Secrets and variables** â†’ **Actions** â†’ **Variables**
2. **New repository variable**
3. Name: `SB_REQUIRED_ASSETS_PATTERNS`
4. Value:
   ```
   .*manual.*_g[0-9a-f]{7,12}\.pdf$
   .*appendix.*_g[0-9a-f]{7,12}\.pdf$
   ```

**Priority:** Repository variable > File > Defaults

---

## Troubleshooting

### Local badge shows incomplete, but all files are there

**Cause:** Pattern mismatch

**Debug:**
```bash
# Check patterns
cat .github/required-assets.txt

# Check actual files
ls release_assets/

# Re-run completeness check
make badge_compute_complete_local
```

### Badge not switching

**Cause:** sed command didn't find pattern

**Solution:** Check README contains badge URLs with exact format:
```markdown
[![Docs Complete](https://img.shields.io/endpoint?url=https://raw.githubusercontent.com/OWNER/REPO/main/.status/docs-release-completeness.json)]
```

### Badges show cached old state

**Cause:** GitHub caches shields.io badges

**Solution:** Wait 5 minutes or force refresh in browser

---

## Best Practices

1. **Always use local badge for development**
   ```bash
   make badges_local_on
   ```

2. **Switch to live before tagging**
   ```bash
   make badges_live_on
   ```

3. **Check completeness before every release**
   ```bash
   make badge_compute_complete_local
   ```

4. **Commit both badge JSONs**
   ```bash
   git add .status/*.json
   ```

5. **Use release helper for automation**
   ```bash
   make release_tag VERSION=v2.0.15
   ```

---

## Related Documentation

- **[BADGE_SYSTEM.md](BADGE_SYSTEM.md)** - Single badge (original)
- **[MODULAR_BUILD_SYSTEM.md](MODULAR_BUILD_SYSTEM.md)** - Build targets
- **[RELEASE_AUTOMATION.md](RELEASE_AUTOMATION.md)** - Complete release flow

---

## Version History

- **v2.0.14** - Dual badge system
  - Separate workflow status + completeness badges
  - Local/live badge toggling
  - Local completeness computation
  - Badge URL management targets
