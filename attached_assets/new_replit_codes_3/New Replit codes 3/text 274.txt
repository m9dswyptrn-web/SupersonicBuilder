#![cfg_attr(not(debug_assertions), windows_subsystem = "windows")]
use std::process::{Command, Stdio};
use std::{thread, time::Duration};

#[tauri::command]
fn launch_python() -> Result<String, String> {
    // Try to start the local Flask UI (non-blocking).
    // Adjust to your venv if needed (python vs python3).
    let _ = Command::new("python")
        .args(["scripts/run_offline_llm.py"])
        .stdout(Stdio::null())
        .stderr(Stdio::null())
        .spawn()
        .map_err(|e| format!("failed to start python: {e}"))?;

    // Wait a moment for the server to boot
    thread::sleep(Duration::from_millis(1200));
    Ok("ok".into())
}

fn main() {
    tauri::Builder::default()
        .invoke_handler(tauri::generate_handler![launch_python])
        .run(tauri::generate_context!())
        .expect("error while running Supersonic");
}