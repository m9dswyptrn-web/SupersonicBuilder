#!/usr/bin/env python3
# Supersonic Commander – tiny web server + health endpoints
import os, time
from flask import Flask, jsonify, Response

app = Flask(__name__)
START_TIME = time.time()

@app.get("/")
def root():
    # Simple HTML 200 OK for platform health probes
    html = "<h1>Supersonic Commander</h1><p>Status: OK</p>"
    return Response(html, status=200, mimetype="text/html")

@app.get("/healthz")
def healthz():
    # Liveness: process is up and responding
    return jsonify(
        status="ok",
        service="supersonic-commander",
        uptime_seconds=round(time.time() - START_TIME, 1),
    ), 200

@app.get("/readyz")
def readyz():
    # Readiness: app is ready to accept traffic (expand checks as needed)
    checks = {
        "voicepacks_loaded": True,   # replace with real check if desired
        "workflows_loaded": True,    # replace with real check if desired
    }
    ready = all(checks.values())
    code = 200 if ready else 503
    return jsonify(status="ready" if ready else "not_ready", checks=checks), code

if __name__ == "__main__":
    port = int(os.getenv("PORT", "8080"))  # Replit/Actions friendly
    app.run(host="0.0.0.0", port=port)     # Bind to all interfaces ✅