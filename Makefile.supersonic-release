# ===== Supersonic One-Command Release =====
# Included by main Makefile via: -include Makefile.supersonic-release

VERSION ?= patch

.PHONY: supersonic-release
supersonic-release:
	@echo "ğŸ” Checking GitHub token..."
	@if [ -z "$${GH_PAT}" ]; then echo "âŒ GH_PAT not set. Add it in Replit Secrets."; exit 1; fi
	@echo "ğŸ§± Building all PDFs and assets..."
	@$(MAKE) supersonic-build-all
	@echo "ğŸš€ Deploying to GitHub Pages..."
	@$(MAKE) supersonic-deploy
	@echo "ğŸ“ Committing and pushing..."
	@git add docs/ out/ || true
	@git commit -m "release: automated Supersonic release [ci skip]" || echo "â„¹ï¸ Nothing to commit."
	@bash -c 'source tools/gh.sh && with_auth_remote git push origin main'
	@echo "ğŸ·ï¸ Tagging new version..."
	@BRANCH=main tools/release_now.sh --$(VERSION) --push-branch
	@echo ""
	@echo "âœ… Release complete! Check your live hub:"
	@echo "ğŸŒ https://m9dswyptrn-web.github.io/SupersonicBuilder/"
